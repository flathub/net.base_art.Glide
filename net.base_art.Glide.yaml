app-id: net.base_art.Glide
runtime: org.gnome.Platform
runtime-version: '49'
sdk: org.gnome.Sdk
sdk-extensions:
  - org.freedesktop.Sdk.Extension.rust-stable
cleanup:
  - /include
command: glide
finish-args:
  - --device=dri
  - --filesystem=xdg-download:ro
  - --filesystem=xdg-videos:ro
  - --filesystem=xdg-music:ro
  - --share=ipc
  - --share=network
  - --socket=fallback-x11
  - --socket=pulseaudio
  - --socket=wayland
build-options:
  append-path: /usr/lib/sdk/rust-stable/bin
  env:
    CARGO_HOME: /run/build/glide/cargo
modules:
  - name: libass
    config-opts:
      - --enable-shared
      - --disable-static
    sources:
      - type: git
        url: https://github.com/libass/libass.git
        tag: 0.17.4
      - type: script
        commands:
          - autoreconf -fiv
        dest-filename: autogen.sh

  - name: gstreamer
    builddir: true
    buildsystem: meson
    sources:
      - type: git
        url: https://gitlab.freedesktop.org/gstreamer/gstreamer
        tag: 1.26.7
        disable-submodules: true
    config-opts:
      - -Ddoc=disabled
      - -Dtests=disabled
      - -Ddevtools=disabled
      - -Dges=disabled
      - -Dlibav=disabled
      - -Drtsp_server=disabled
      - -Dgst-examples=disabled
      - -Dpython=disabled
      - -Dwebrtc=disabled
      - -Dgpl=enabled
      - -Dgst-plugins-ugly:gpl=enabled
      - -Dgst-plugins-bad:gpl=enabled
      - -Dgst-plugins-bad:openh264=disabled

  - name: glide
    buildsystem: meson
    sources:
      - type: archive
        url: https://github.com/philn/glide/releases/download/0.6.5/glide-0.6.5.tar.xz
        sha256: d987391efff91b07f4968f0dc929c9a885b3dc8034bd19f445abcef5a8d83117
        x-checker-data:
          type: json
          url: https://api.github.com/repos/philn/glide/releases/latest
          version-query: .tag_name | sub("^glide-"; "")
          url-query: .assets[] | select(.name=="glide-" + $version + ".tar.xz") |
            .browser_download_url
